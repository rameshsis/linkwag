<?phpfunction __autoload($c) {    loadClass($c);}function loadClass($class){    if(file_exists(LINKWAG_ACTION.DS.$class.P)){        include LINKWAG_ACTION . DS . strtolower($class) . P;    }}class Linkwag extends Action{    public function __construct() {         parent::__construct();        add_action('admin_menu', array($this,'setup'));       }    public function setup(){         add_menu_page( 'LinkWag', 'LinkWag', 'manage_options', 'linkwag-settings',array($this,'execute') ); 		 add_submenu_page('linkwag-settings','LinkWag Settings','LinkWag Settings','manage_options','linkwag-settings', array($this,'execute') );				 if(get_option('save_changes') == '1'){		 add_submenu_page('linkwag-settings','Links','Links', 8,'linkwag-links', array($this,'execute') );		 }         		 add_action('add_meta_boxes',array($this,'addMetaBox') );         add_action('save_post', array($this,'savePost'));    }    public function  execute(){        if($this->class){             $controller = new $this->class();           $this->controller = call_user_func_array(array($controller,$this->method), $this->args);        }    }    public function addMetaBox(){        $types = grv_get_post_types();        foreach($types as $postype)         add_meta_box('linkwag',__( 'Linkwag', 'linkwag' ),array($this,'innerHtml'),$postype,'side');    }       public function innerHtml($post){ $s=get_post_type($post);		if($s == 'post'){        if((get_option('wag_new_post_auto')== '1') or (get_option('wag_new_post_auto')== '2')):?>        <input checked="checked" type="checkbox" name="check_wag_post" value="<?php echo $post->ID; ?>" />&nbsp;&nbsp;&nbsp;		<?php else: ?>        <input  type="checkbox" name="check_wag_post" value="<?php echo $post->ID; ?>" />&nbsp;&nbsp;&nbsp;        <?php endif; ?>        <label>Wag post automatically to linkwag.</label>        <?php 		}			if($s == 'page'){ 		  if(get_option('wag_new_page_auto')== '1'):?>        <input checked="checked" type="checkbox" name="check_wag_post" value="<?php echo $post->ID; ?>" />&nbsp;&nbsp;&nbsp;		<?php else: ?>        <input  type="checkbox" name="check_wag_post" value="<?php echo $post->ID; ?>" />&nbsp;&nbsp;&nbsp;        <?php endif; ?>        <label>Wag post automatically to linkwag.</label>        <?php 		}			}        public function savePost($post_id){        //echo $_GET['action'];       		//echo $post_id;				//die();     if ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE )       return;        if(isset($_POST['check_wag_post'])){            if($_POST['check_wag_post']!='')                $state=true;            else                 $state=false;           wag_post($post_id,$state);         }				if($_GET['action'] == 'trash' || $_GET['action'] == 'delete')		{				$state=false;           			wag_post($post_id,$state);			}			if($_GET['action'] == 'untrash' )		{					$state=true;         			wag_post($post_id,$state);			}    } }class Action{        protected $class;    protected $method;    protected $args = array();    protected $template='';    var $data = array();    public function __construct() {       $this->getRequest();        if(isset($_POST['save_linkwag_options'])){		update_option('save_changes',1);		}    }        public function __set($key,$val){            }        public function __get($val){            }        public function getRequest(){        if(isset($_GET['page'])){            $route = $_GET['page'];            $parts = explode('-',$route);            if(isset($parts[1]))                $this->class = $parts[1];                                    if(isset($parts[2]))            $this->method = $parts[2];                        if(isset($parts[3]))            $this->args[] = $parts[3];                        if(isset($parts[4]))            $this->args[] = $parts[4];                        if(empty($this->method))                    $this->method = 'index';        }    }        public function render(){               extract($this->data);        if(LINKWAG_VIEW .DS. $this->template . P){            require(LINKWAG_VIEW .DS. $this->template . P);        }else            echo '<p>View Not found</p>';       }    }